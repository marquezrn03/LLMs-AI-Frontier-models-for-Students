<script>
document.addEventListener('DOMContentLoaded', () => {
    const getEl = (id) => document.getElementById(id);

    // --- Scroll Animations ---
    const animatedElements = document.querySelectorAll('.animate-on-scroll');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                // Optional: unobserve after animation to save resources
                // observer.unobserve(entry.target); 
            }
        });
    }, { threshold: 0.1 }); // Trigger when 10% of the element is visible

    animatedElements.forEach(el => {
        observer.observe(el);
    });

    // --- Interactive LLM Limitations Explorer (Cards) ---
    const limitationCardContainer = document.querySelector('#understanding-llms .interactive-card-container');
    if (limitationCardContainer) {
        const limitationCards = limitationCardContainer.querySelectorAll('.interactive-card');
        limitationCards.forEach(card => {
            card.addEventListener('click', () => {
                const isActive = card.classList.contains('active');
                // Close any other active card within this container
                limitationCardContainer.querySelectorAll('.interactive-card.active').forEach(activeCard => {
                    if (activeCard !== card) { // Only close if it's not the clicked card
                        activeCard.classList.remove('active');
                        const otherContent = activeCard.querySelector('.interactive-card-content');
                        if (otherContent) {
                            otherContent.style.maxHeight = null;
                            otherContent.style.opacity = '0';
                            setTimeout(() => { if(!activeCard.classList.contains('active')) otherContent.style.display = 'none'; }, 400);
                        }
                    }
                });
                // Toggle the clicked card
                if (!isActive) {
                    card.classList.add('active');
                    const content = card.querySelector('.interactive-card-content');
                    if (content) {
                        content.style.display = 'block';
                        setTimeout(() => { // Timeout to allow display:block to take effect before transition
                            content.style.maxHeight = content.scrollHeight + "px";
                            content.style.opacity = '1';
                        }, 10);
                    }
                } else { // If it was already active, close it
                    card.classList.remove('active');
                    const content = card.querySelector('.interactive-card-content');
                     if (content) {
                        content.style.maxHeight = null;
                        content.style.opacity = '0';
                        setTimeout(() => { if(!card.classList.contains('active')) content.style.display = 'none'; }, 400);
                    }
                }
            });
        });
    }
    
    // --- LLM Capabilities Carousel ---
    const capabilitiesData = [
        { icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z" /><path fill-rule="evenodd" d="M9.344 3.071a49.52 49.52 0 015.312 0c.997.056 1.95.422 2.723.994l2.261 2.26c.572.573.939 1.291.994 2.087a49.52 49.52 0 010 5.312c-.056.997-.422 1.95-.994 2.723l-2.26 2.261c-.573.572-1.291.939-2.087.994a49.52 49.52 0 01-5.312 0c-.997-.056-1.95-.422-2.723-.994l-2.261-2.26c-.572-.573-.939-1.291-.994-2.087a49.52 49.52 0 010-5.312c.056-.997.422-1.95.994-2.723l2.26-2.261c.573-.572 1.291-.939 2.087-.994zM12 5.25a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5z" clip-rule="evenodd" /></svg>`, title: "Aprenentatge Personalitzat i Tutoria Intel·ligent", description: "Adaptació dinàmica a estils i ritmes d'aprenentatge individuals, oferint explicacions a mida, exemples variats i feedback formatiu per a la comprensió profunda de conceptes. [2, 3, 8, 17-22]" },
        { icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10.5 1.875a1.125 1.125 0 012.25 0v2.383c.43.163.838.393 1.212.672l1.69-1.69a.75.75 0 011.06 1.06l-1.689 1.69c.28.374.51.782.672 1.212h2.383a1.125 1.125 0 010 2.25h-2.383a5.443 5.443 0 01-.672 1.212l1.69 1.69a.75.75 0 01-1.06 1.06l-1.69-1.689a5.443 5.443 0 01-1.212.672v2.383a1.125 1.125 0 01-2.25 0v-2.383a5.443 5.443 0 01-1.212-.672l-1.69 1.69a.75.75 0 01-1.06-1.06l1.689-1.69a5.443 5.443 0 01-.672-1.212H4.125a1.125 1.125 0 010-2.25h2.383c.163-.43.393-.838.672-1.212l-1.69-1.69a.75.75 0 011.06-1.06l1.69 1.689c.374-.28.782-.51 1.212-.672V1.875zM12 6a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5z" /></svg>`, title: "Assistència Avançada en Recerca", description: "Facilitació de revisions de literatura (identificació de temes, resum d'articles), generació d'hipòtesis, i suport en el disseny metodològic. Requereix validació experta. [2, 23-25, 27]" },
        { icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M6.75 6.31V15.75a.75.75 0 001.5 0V6.31h5.034a2.25 2.25 0 012.091 1.494l2.006 5.014a.75.75 0 001.14-.456L19.998 8.51a2.25 2.25 0 00-2.09-1.494H15V6.31a.75.75 0 00-1.5 0v.75H8.25V6.31a.75.75 0 00-1.5 0zM4.125 4.5A.75.75 0 003.375 3H2.25a.75.75 0 000 1.5h1.125V15.75A2.25 2.25 0 005.625 18h12.75A2.25 2.25 0 0020.625 15.75V3.75H21.75a.75.75 0 000-1.5H20.625a2.25 2.25 0 00-2.25-2.25H5.625A2.25 2.25 0 003.375 2.25V3H4.125a.75.75 0 000 1.5z" clip-rule="evenodd" /></svg>`, title: "Escriptura Acadèmica Augmentada", description: "Suport en la pluja d'idees, estructuració d'arguments, redacció d'esborranys inicials, millora de la claredat, cohesió i estil. La veu i l'autoria han de ser de l'estudiant. [1, 2, 9, 16, 29, 30]" },
        { icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M2.25 2.25a.75.75 0 000 1.5H3v10.5a3 3 0 003 3h1.21l-2.173 3.259a.75.75 0 001.06 1.061l2.757-4.136A4.5 4.5 0 0110.5 18H15v.75a.75.75 0 001.5 0V18h1.5v.75a.75.75 0 001.5 0V18h1.5a3 3 0 003-3V3.75h.75a.75.75 0 000-1.5H2.25zM6 15h9V6H6v9zm7.5-5.25h-6a.75.75 0 000 1.5h6a.75.75 0 000-1.5z" clip-rule="evenodd" /></svg>`, title: "Anàlisi de Dades i Programació", description: "Ajuda en la generació i depuració de codi (Python, R), anàlisi exploratòria de dades, interpretació de resultats estadístics i codificació qualitativa inicial. [6, 31-35, 43]" },
        { icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.315 7.584C12.195 3.883 16.695 1.5 21.75 1.5a.75.75 0 01.75.75c0 5.056-2.383 9.555-6.084 12.436A6.75 6.75 0 019.75 22.5a.75.75 0 01-.75-.75v-4.131A15.838 15.838 0 016.382 15H2.25a.75.75 0 01-.75-.75 6.75 6.75 0 017.815-6.666zM15 6.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z" clip-rule="evenodd" /><path d="M5.26 17.242a.75.75 0 10-.897-1.203 5.243 5.243 0 00-2.05 5.022.75.75 0 00.625.627 5.243 5.243 0 005.022-2.051.75.75 0 10-1.202-.897 3.744 3.744 0 01-3.008 1.51c0-1.23.592-2.323 1.51-3.008z" /></svg>`, title: "Desenvolupament d'Habilitats Transversals", description: "Foment de la resolució de problemes complexos, pensament crític mitjançant la interacció reflexiva, i millora de la comunicació escrita i la presentació d'idees. [2, 36]" }
    ];
    const carouselTrack = document.querySelector('.capability-carousel-track');
    const prevBtn = getEl('prev-capability-btn');
    const nextBtn = getEl('next-capability-btn');
    let currentCapabilityIndex = 0;

    function populateCarousel() {
        if (!carouselTrack) return;
        carouselTrack.innerHTML = ''; 
        capabilitiesData.forEach(cap => {
            const slide = document.createElement('div');
            slide.classList.add('capability-slide');
            slide.innerHTML = `${cap.icon}<h5>${cap.title}</h5><p>${cap.description}</p>`;
            carouselTrack.appendChild(slide);
        });
        updateCarouselVisual();
    }

    function updateCarouselVisual() {
        if (!carouselTrack || !carouselTrack.children.length) return;
        // Ensure children are loaded before trying to get offsetWidth
        if (carouselTrack.querySelector('.capability-slide')) {
            const slideWidth = carouselTrack.querySelector('.capability-slide').offsetWidth;
            carouselTrack.style.transform = `translateX(-${currentCapabilityIndex * slideWidth}px)`;
        }
    }

    if (nextBtn) nextBtn.addEventListener('click', () => { currentCapabilityIndex = (currentCapabilityIndex + 1) % capabilitiesData.length; updateCarouselVisual(); });
    if (prevBtn) prevBtn.addEventListener('click', () => { currentCapabilityIndex = (currentCapabilityIndex - 1 + capabilitiesData.length) % capabilitiesData.length; updateCarouselVisual(); });
    
    populateCarousel(); 
    window.addEventListener('resize', updateCarouselVisual);


    // --- D3.js Mind Map for LLM Concepts ---
    const mindMapContainer = getEl('llm-mind-map-container');
    if (mindMapContainer && typeof d3 !== 'undefined') {
        const width = mindMapContainer.clientWidth;
        const height = 450; 

        const mindMapData = {
            name: "Ecosistema LLM",
            children: [
                { name: "Fonaments", children: [
                    { name: "Dades d'Entrenament (Corpus massius)", size: 6000 },
                    { name: "Arquitectura (Transformers)", children:[
                        {name: "Atenció", size: 3000}, {name: "Codificació Posicional", size:2500}
                    ], size: 5000 },
                    { name: "Aprenentatge Profund", size: 4500 }
                ]},
                { name: "Capacitats", children: [
                    { name: "Generació de Text", size: 5500 }, { name: "Traducció", size: 4000 },
                    { name: "Resum", size: 4800 }, { name: "Resposta a Preguntes", size: 5200 },
                    { name: "Generació de Codi", size: 4500}
                ]},
                { name: "Enginyeria de Prompts", children: [
                    { name: "Claredat i Context", size: 4000 }, { name: "Iteració", size: 3500 },
                    { name: "Zero/Few-Shot", size: 3800 }, {name: "Cadena de Pensament (CoT)", size: 3900}
                ]},
                { name: "Limitacions", children: [
                    { name: "Al·lucinacions", size: 5000 }, { name: "Biaixos", size: 4800 },
                    { name: "Comprensió Superficial", size: 4500 }, { name: "Finestra de Context", size: 3800 }
                ]},
                { name: "Consideracions Ètiques", children: [
                    { name: "Plagi i Autoria", size: 4200 }, { name: "Privadesa de Dades", size: 3900 },
                    { name: "Desinformació", size: 4500 }, { name: "Impacte Social", size: 4000 }
                ]}
            ]
        };

        const root = d3.hierarchy(mindMapData).sum(d => d.size || 1).sort((a, b) => b.value - a.value);
        const pack = d3.pack().size([width - 4, height - 4]).padding(5); // Increased padding slightly
        const packedRoot = pack(root);

        const svg = d3.select(mindMapContainer).append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", `0 0 ${width} ${height}`)
            .style("display", "block")
            .style("margin", "0 auto")
            .style("background", "var(--primary-lightest)")
            .style("cursor", "grab");

        const node = svg.selectAll("g")
            .data(packedRoot.descendants().slice(1)) // Process all descendants except the root itself for links if needed
            .join("g")
              .attr("transform", d => `translate(${d.x + 1},${d.y + 1})`)
              .attr("class", "mind-map-node");

        const colorScale = d3.scaleOrdinal(d3.schemeTableau10);

        node.append("circle")
            .attr("r", d => d.r)
            .attr("fill", d => colorScale(d.depth === 1 ? d.data.name : (d.parent ? d.parent.data.name : d.data.name))) // Color top-level categories distinctly
            .attr("fill-opacity", 0.7)
            .attr("stroke", d => d3.rgb(colorScale(d.depth === 1 ? d.data.name : (d.parent ? d.parent.data.name : d.data.name))).darker());


        node.filter(d => d.children === undefined) // Only add text to leaf nodes for clarity in packed circles
            .append("text")
            .attr("clip-path", d => `circle(${d.r * 0.9})`) // Clip text to circle
            .selectAll("tspan")
            .data(d => {
                const words = d.data.name.split(/(?=[A-Z][a-z])|\s+/g);
                // Simple heuristic to fit text: if radius is small, take fewer words or abbreviate
                if (d.r < 20 && words.length > 2) return [words[0] + (words[1] ? "..." : "")];
                if (d.r < 30 && words.length > 3) return words.slice(0,2).concat("...");
                return words;
            }) 
            .join("tspan")
                .attr("x", 0)
                .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.7}em`) // Adjusted for better centering
                .style("font-size", d_node => { // d_node is the datum for the parent 'node'
                    const textForSizing = d3.select(this).text(); // get the current tspan text
                    return Math.max(6, Math.min(d_node.r / 3, d_node.r / (textForSizing.length * 0.5))) + "px";
                })
                .text(d => d);
        
        node.append("title").text(d => `${d.ancestors().map(d_anc => d_anc.data.name).reverse().slice(1).join(" > ")}\nValor (conceptual): ${d.value}`);
    }


    // --- Hallucination Buster Mini-Puzzle (Advanced) ---
    const hallucinationOptionsContainer = getEl('hallucination-buster-options');
    const hallucinationFeedbackEl = getEl('hallucination-buster-feedback');
    const hallucinationPuzzles = [ // Ensure this is defined
        {
            options: [
                { text: "La potenciació a llarg termini (LTP) al hipocamp depèn exclusivament de l'activació dels receptors NMDA.", isHallucination: true, feedback:"Aquesta és una simplificació excessiva i, per tant, una 'al·lucinació' subtil. Tot i que els receptors NMDA són crucials, altres factors com els receptors AMPA, els canals de calci dependents de voltatge i diversos processos moleculars intracel·lulars també són essencials per a la inducció i manteniment de la LTP." },
                { text: "La connectivitat funcional, mesurada amb fMRI en estat de repòs, reflecteix correlacions temporals en l'activitat BOLD entre diferents regions cerebrals.", isHallucination: false, feedback: "Correcte. Aquesta és una descripció precisa del concepte de connectivitat funcional en neuroimatge." },
                { text: "Els models computacionals de xarxes neuronals profundes han demostrat ser capaços d'aprendre representacions jeràrquiques similars a les observades en el còrtex visual.", isHallucination: false, feedback: "Correcte. Aquesta és una àrea activa i fructífera de recerca en neurociència computacional i IA."}
            ]
        }
    ];
    let currentHallucinationPuzzle = 0;

    function loadHallucinationPuzzle(index) {
        if (!hallucinationOptionsContainer || !hallucinationFeedbackEl || !hallucinationPuzzles[index]) return;
        const puzzle = hallucinationPuzzles[index];
        hallucinationOptionsContainer.innerHTML = '';
        puzzle.options.forEach(opt => {
            const optEl = document.createElement('div');
            optEl.classList.add('hallucination-buster-option');
            optEl.innerHTML = opt.text; 
            optEl.addEventListener('click', () => {
                hallucinationFeedbackEl.innerHTML = `<strong>Anàlisi:</strong> ${opt.feedback}`;
                hallucinationFeedbackEl.className = 'hallucination-buster-feedback'; 
                hallucinationFeedbackEl.classList.add(opt.isHallucination ? 'feedback-bad' : 'feedback-good');
                hallucinationFeedbackEl.style.display = 'block';
                requestAnimationFrame(() => { hallucinationFeedbackEl.style.opacity = '1'; });
            });
            hallucinationOptionsContainer.appendChild(optEl);
        });
        hallucinationFeedbackEl.style.display = 'none';
        hallucinationFeedbackEl.style.opacity = '0';
    }
    if(hallucinationPuzzles.length > 0 && hallucinationOptionsContainer) {
        loadHallucinationPuzzle(currentHallucinationPuzzle);
    }

    // --- Enhanced Interactive Prompt Engineering Guide ("Sandbox") ---
    const promptTaskSelectSandbox = getEl('prompt-task-select-sandbox');
    const promptExampleStructureContainer = getEl('prompt-example-structure');
    const promptExampleStructureEl = promptExampleStructureContainer ? promptExampleStructureContainer.querySelector('p') : null;
    const promptDetailSlider = getEl('prompt-detail-slider');
    const promptDetailSliderValue = getEl('prompt-detail-slider-value');
    const promptLevelDisplay = getEl('prompt-level-display');
    const userPromptInputEl = getEl('user-prompt-input');
    const showPromptCritiqueBtn = getEl('show-prompt-critique-btn');
    const promptCritiqueAreaEl = getEl('prompt-critique-area');

    const promptSandboxData = { // Ensure this is fully defined
        summarize: {
            levels: [
                "<strong>Nivell 1 (Bàsic):</strong>\n<code>Resumeix el següent text sobre [TEMA GENERAL]:\n\n[ENGANXA TEXT AQUÍ]</code>",
                "<strong>Nivell 2 (Intermedi):</strong>\n<code>Actua com un assistent de recerca. Proporciona un resum concís (aprox. 150 paraules) dels punts clau, metodologia i resultats principals del següent abstract d'article científic sobre [TEMA ESPECÍFIC]:\n\n[ENGANXA ABSTRACT AQUÍ]\n\nL'audiència són estudiants de grau de [DISCIPLINA].</code>",
                "<strong>Nivell 3 (Avançat/Postgrau):</strong>\n<code>Com a expert en [CAMP D'ESTUDI ESPECÍFIC], realitza una síntesi crítica (300-400 paraules) de l'article adjunt ([NOM DE L'ARTICLE CURT]). El teu resum ha d'abordar:\n1. La pregunta de recerca principal i la seva rellevància.\n2. El marc teòric i l'enfocament metodològic (amb punts forts/febles).\n3. Les troballes més significatives i la seva interpretació.\n4. Les limitacions de l'estudi reconegudes pels autors i altres que puguis identificar.\n5. Dues implicacions clau per a futures línies de recerca o per a la pràctica professional en [SUB-CAMP].\n\n[SI ÉS POSSIBLE, ENLLAÇ O PRIMERS PARÀGRAFS DE L'ARTICLE AQUÍ]</code>"
            ],
            critique: (userInput, level) => `<strong>Anàlisi Conceptual del Teu Prompt (Nivell ${level}):</strong><br>Input Rebut: "${userInput}"<br><br>* <strong>Claredat de la Tasca:</strong> ${userInput.toLowerCase().includes("resumeix") || userInput.toLowerCase().includes("síntesi") ? "✔️ Tasca de resum/síntesi explícita." : "⚠️ Considera indicar explícitament 'resumeix' o 'fes una síntesi'."}<br>* <strong>Especificitat del Text Font:</strong> ${userInput.match(/\[ENGANXA TEXT AQUÍ\]|\[ENGANXA ABSTRACT AQUÍ\]|adjunt/i) ? "✔️ Indicació de text font." : "⚠️ Especifica clarament quin text s'ha de resumir."}<br>* <strong>Contextualització (Rol/Audiència):</strong> ${userInput.match(/actua com un|l'audiència són|com a expert en/i) ? "✔️ Bon ús de rol/audiència per contextualitzar." : (level > 1 ? "⚠️ Per a nivells avançats, definir un rol (ex: 'expert en X') i audiència millora el resultat." : "ℹ️ Definir rol/audiència pot ser útil.")}<br>* <strong>Longitud/Format:</strong> ${userInput.match(/\d+\s*paraules|concís|punts clau/i) ? "✔️ S'han inclòs restriccions de longitud/format." : "⚠️ Considera especificar una longitud (ex: '200 paraules') o un format (ex: 'en 3 punts')."}<br>* <strong>Enfocament del Contingut:</strong> ${userInput.match(/punts clau|metodologia|resultats|implicacions|síntesi crítica/i) ? "✔️ Es demana un enfocament específic del contingut." : "⚠️ Per a resums acadèmics, demana que se centri en aspectes com metodologia, resultats, conclusions, o implicacions."}<br>* <strong>Nivell de Detall/Anàlisi (per Postgrau):</strong> ${level === 3 && userInput.match(/crítica|punts forts\/febles|limitacions/i) ? "✔️ Adequat per a postgrau, demanant anàlisi crítica." : (level === 3 ? "⚠️ Per a postgrau, considera demanar una avaluació més crítica, no només un resum descriptiu." : "")}`
        },
        brainstorm_rq: {
            levels: [
                "<strong>Nivell 1 (Bàsic):</strong>\n<code>Idees de recerca sobre [TEMA GENERAL AMPLI] per a un treball de classe.</code>",
                "<strong>Nivell 2 (Intermedi):</strong>\n<code>Sóc un estudiant de grau de [DISCIPLINA] interessat en [TEMA MÉS ESPECÍFIC]. Genera 3-4 preguntes de recerca originals i factibles per a un projecte de fi de grau que explorin la relació entre [VARIABLE/CONCEPTE 1] i [VARIABLE/CONCEPTE 2] en el context de [CONTEXT ESPECÍFIC].</code>",
                "<strong>Nivell 3 (Avançat/Postgrau):</strong>\n<code>Estic iniciant la meva tesi doctoral en [CAMP D'ESTUDI] i el meu enfocament preliminar és [DESCRIPCIÓ DETALLADA DEL TEU INTERÈS DE RECERCA, INCLOENT BUITS IDENTIFICATS EN LA LITERATURA O DEBATS ACTUALS]. Actuant com un investigador sènior en aquest camp, proposa 3-5 preguntes de recerca altament específiques, innovadores i amb potencial de contribució significativa. Per a cada pregunta, suggereix breument un possible enfocament metodològic (qualitatiu, quantitatiu, mixt) i justifica la seva rellevància teòrica i pràctica.</code>"
            ],
            critique: (userInput, level) => `<strong>Anàlisi Conceptual del Teu Prompt (Nivell ${level}):</strong><br>Input Rebut: "${userInput}"<br><br>* <strong>Definició del Tema:</strong> ${userInput.split(" ").length > 7 ? "✔️ Tema sembla definit amb cert detall." : "⚠️ El tema podria ser més específic per obtenir preguntes més enfocades."}<br>* <strong>Context Acadèmic (Nivell/Propòsit):</strong> ${userInput.match(/grau|tesi doctoral|projecte de fi de grau/i) ? "✔️ Context acadèmic clar." : "⚠️ Especificar el nivell (grau, postgrau, tesi) ajuda a l'LLM a ajustar la complexitat."}<br>* <strong>Nombre de Preguntes:</strong> ${userInput.match(/\d+.*preguntes/i) ? "✔️ Nombre de preguntes especificat." : "⚠️ Considera demanar un nombre específic de preguntes."}<br>* <strong>Criteris de Qualitat de les Preguntes:</strong> ${userInput.match(/originals|factibles|innovadores|contribució significativa/i) ? "✔️ Bons criteris per a les preguntes." : "⚠️ Pots afegir criteris com 'rellevants', 'específiques', 'que abordin un buit en la literatura'."}<br>* <strong>Directrius Addicionals (per Postgrau):</strong> ${level === 3 && userInput.match(/enfocament metodològic|justifica la seva rellevància/i) ? "✔️ Excel·lent, demanant justificació i metodologia per a postgrau." : (level === 3 ? "⚠️ Per a postgrau, demanar suggeriments metodològics o justificació de la rellevància pot ser molt útil." : "")}`
        },
        explain_concept: {
            levels: [
                "<strong>Nivell 1 (Bàsic):</strong>\n<code>Explica [CONCEPTE SENZILL] com si ho expliquessis a un nen de 10 anys.</code>",
                "<strong>Nivell 2 (Intermedi):</strong>\n<code>Defineix [CONCEPTE ACADÈMIC CLAU] i proporciona un exemple pràctic de la seva aplicació en [DISCIPLINA]. L'audiència són estudiants de primer any.</code>",
                "<strong>Nivell 3 (Avançat/Postgrau):</strong>\n<code>Com a expert en [CAMP TEÒRIC], desgrana el concepte de [CONCEPTE COMPLEX AVANÇAT]. Compara'l i contrasta'l amb [CONCEPTE RELACIONAT PERÒ DIFERENT]. Analitza les seves implicacions per a la recerca actual en [SUB-CAMP ESPECÍFIC]. Utilitza un llenguatge acadèmic precís.</code>"
            ],
            critique: (userInput, level) => `<strong>Anàlisi Conceptual del Teu Prompt (Nivell ${level}):</strong><br>Input Rebut: "${userInput}"<br><br>* <strong>Claredat del Concepte:</strong> ${userInput.match(/\[CONCEPTE.*?\]/i) ? "✔️ Concepte a explicar identificat." : "⚠️ Especifica clarament quin concepte vols que s'expliqui."}<br>* <strong>Definició d'Audiència/Rol:</strong> ${userInput.match(/com si ho expliquessis a|l'audiència són|com a expert en/i) ? "✔️ Rol/audiència definits." : (level > 1 ? "⚠️ Considera definir rol/audiència per ajustar la complexitat." : "ℹ️ Definir rol/audiència pot ajudar.")}<br>* <strong>Petició d'Exemples/Comparacions:</strong> ${userInput.match(/exemple|compara.*contrasta/i) ? "✔️ Demana exemples o comparacions, la qual cosa és bo." : "⚠️ Per a una millor comprensió, demanar exemples o comparacions és útil."}<br>* <strong>Profunditat d'Anàlisi (per Postgrau):</strong> ${level === 3 && userInput.match(/implicacions|analitza/i) ? "✔️ Sol·licitud d'anàlisi profunda adequada." : (level === 3 ? "⚠️ Per a postgrau, demana una anàlisi més profunda de les implicacions o debats teòrics." : "")}`
        },
        coding_help: {
            levels: [
                "<strong>Nivell 1 (Bàsic):</strong>\n<code>Codi en Python per [TASCA DE PROGRAMACIÓ SENZILLA, ex: llegir un arxiu de text i comptar paraules].</code>",
                "<strong>Nivell 2 (Intermedi):</strong>\n<code>Tinc aquest error en el meu script de [LLENGUATGE, ex: Python] quan intento [ACCIÓ ESPECÍFICA]:\n\n[ENGANXA L'ERROR COMPLET]\n\nAquest és el fragment de codi rellevant:\n\n\`\`\`[llenguatge]\n[ENGANXA CODI PROBLEMÀTIC]\n\`\`\`\n\nQuina podria ser la causa i com ho puc solucionar?</code>",
                "<strong>Nivell 3 (Avançat/Postgrau):</strong>\n<code>Estic treballant en un script de [LLENGUATGE, ex: R o Python amb biblioteques científiques] per a [ANÀLISI DE DADES CIENTÍFIQUES COMPLEXA]. Vull optimitzar el rendiment de la següent funció que processa [TIPUS DE DADES GRANS]:\n\n\`\`\`[llenguatge]\n[ENGANXA FUNCIÓ A OPTIMITZAR]\n\`\`\`\n\nProposa 2-3 estratègies d'optimització (ex: vectorització, paral·lelització, ús de biblioteques més eficients, canvis algorítmics), explicant els pros i contres de cadascuna en termes de velocitat i consum de memòria per a aquest context específic.</code>"
            ],
            critique: (userInput, level) => `<strong>Anàlisi Conceptual del Teu Prompt (Nivell ${level}):</strong><br>Input Rebut: "${userInput}"<br><br>* <strong>Especificitat de la Tasca/Problema:</strong> ${userInput.split(" ").length > 10 || userInput.includes("```") ? "✔️ Problema/tasca sembla ben descrit." : "⚠️ Intenta ser el més específic possible sobre el que vols aconseguir o el problema que tens."}<br>* <strong>Inclusió de Codi/Errors:</strong> ${userInput.includes("```") || userInput.includes("[ENGANXA L'ERROR COMPLET]") ? "✔️ Excel·lent per incloure codi i/o missatges d'error." : (level > 1 ? "⚠️ Si tens un problema de codi, enganxa el codi rellevant i qualsevol missatge d'error." : "")}<br>* <strong>Context (Llenguatge, Biblioteques):</strong> ${userInput.match(/Python| R |Java|JavaScript|Pandas|NumPy/i) ? "✔️ Context de llenguatge/biblioteca proporcionat." : "⚠️ Especificar el llenguatge de programació i les biblioteques utilitzades és crucial."}<br>* <strong>Objectiu Clar (per Postgrau):</strong> ${level === 3 && userInput.match(/optimitza|rendiment|estratègies d'optimització/i) ? "✔️ Objectiu d'optimització clar." : (level === 3 ? "⚠️ Per a tasques avançades, defineix clarament l'objectiu (ex: 'millorar velocitat', 'reduir memòria')." : "")}`
        }
    };

    function updatePromptSandboxDetails() {
        if (!promptTaskSelectSandbox || !promptSandboxData || !promptExampleStructureEl || !promptDetailSlider || !promptLevelDisplay) return;
        const selectedTask = promptTaskSelectSandbox.value;
        const detailLevelIndex = parseInt(promptDetailSlider.value) -1; 
        const data = promptSandboxData[selectedTask];
        
        if (!data || !data.levels || !data.levels[detailLevelIndex]) return;

        promptExampleStructureEl.innerHTML = data.levels[detailLevelIndex]; 
        if(promptLevelDisplay) promptLevelDisplay.textContent = detailLevelIndex + 1;
        if (promptDetailSliderValue) promptDetailSliderValue.textContent = ["Bàsic", "Intermedi", "Avançat"][detailLevelIndex];

        if (userPromptInputEl) userPromptInputEl.value = ''; 
        if (promptCritiqueAreaEl) {
            promptCritiqueAreaEl.style.display = 'none';
            promptCritiqueAreaEl.style.opacity = '0';
            promptCritiqueAreaEl.innerHTML = ''; 
        }
    }
    
    if (promptDetailSlider && promptDetailSliderValue) {
        promptDetailSlider.addEventListener('input', () => {
            const detailLevelIndex = parseInt(promptDetailSlider.value) -1;
            promptDetailSliderValue.textContent = ["Bàsic", "Intermedi", "Avançat"][detailLevelIndex];
            updatePromptSandboxDetails();
        });
    }

    if (promptTaskSelectSandbox) promptTaskSelectSandbox.addEventListener('change', updatePromptSandboxDetails);
    
    if (showPromptCritiqueBtn) {
        showPromptCritiqueBtn.addEventListener('click', () => {
            if (!promptTaskSelectSandbox || !userPromptInputEl || !promptCritiqueAreaEl || !promptSandboxData || !promptDetailSlider) return;
            const selectedTask = promptTaskSelectSandbox.value;
            const detailLevel = parseInt(promptDetailSlider.value);
            const data = promptSandboxData[selectedTask];
            if (!data || !data.critique) return;
            const userInput = userPromptInputEl.value;
            promptCritiqueAreaEl.innerHTML = data.critique(userInput, detailLevel).replace(/\n/g, '<br>');
            promptCritiqueAreaEl.style.display = 'block';
            requestAnimationFrame(() => { promptCritiqueAreaEl.style.opacity = '1'; });
        });
    }
    updatePromptSandboxDetails(); 

    // --- Ethical Dilemma Mini-Simulator (Advanced) ---
    const ethicalDilemmaTextEl = getEl('dilemma-text');
    const ethicalChoicesContainer = getEl('ethical-dilemma-choices-container');
    const ethicalFeedbackContainer = getEl('ethical-dilemma-feedback-container');
    const nextEthicalDilemmaBtn = getEl('next-dilemma-btn');

    const ethicalDilemmas = [ // Ensure this is defined
        {
            scenario: "Estàs preparant una presentació per a un seminari de postgrau i trobes un LLM capaç de generar diapositives visualment atractives amb contingut rellevant a partir d'un simple esquema. El termini s'acosta.",
            choices: [
                { text: "Utilitzar l'LLM per generar totes les diapositives i el contingut, fent només ajustos menors de disseny.", type: "bad", feedback: "<strong>Decisió Problemàtica:</strong> Això pot portar a una presentació superficial que no reflecteixi la teva comprensió profunda. El contingut generat pot contenir imprecisions o biaixos no detectats. A més, és una oportunitat perduda per desenvolupar les teves habilitats de síntesi i comunicació visual. Pot ser considerat deshonestedat acadèmica si no es declara l'ús extensiu de l'IA." },
                { text: "Desenvolupar tu mateix el contingut clau i l'estructura de cada diapositiva. Després, utilitzar l'LLM per suggerir millores de disseny, generar icones/imatges rellevants (verificant-ne la llicència) o refinar la redacció d'alguns punts per a més claredat.", type: "good", feedback: "<strong>Enfocament Ètic i Efectiu:</strong> Mantens el control intel·lectual i l'autoria del contingut, utilitzant l'LLM com una eina d'assistència per millorar aspectes específics. Això demostra un ús responsable i estratègic de la tecnologia." },
                { text: "Demanar a l'LLM que generi l'esquema inicial i alguns punts clau per a cada secció, i després expandir i reescriure completament aquest material amb la teva pròpia investigació i anàlisi.", type: "bad", feedback: "<strong>Pràctica Qüestionable:</strong> Tot i que hi ha més intervenció que en la primera opció, dependre de l'LLM per a l'estructura i els punts fonamentals pot limitar la teva capacitat de desenvolupar un argument original i profund. El risc de plagi subtil o de manca d'originalitat persisteix si la reescriptura no és prou exhaustiva i crítica." }
            ]
        },
        {
            scenario: "En una col·laboració de recerca per a un article de postgrau, un company suggereix utilitzar un LLM per parafrasejar seccions extenses de diversos articles per accelerar la redacció de la revisió de literatura, assegurant que el detector de plagi no ho marcarà.",
            choices: [
                { text: "Acceptar la proposta, confiant que l'eina de parafraseig evitarà problemes de plagi.", type: "bad", feedback: "<strong>Risc Ètic Greu:</strong> Això és una forma de plagi, encara que sigui sofisticat ('plagi de mosaic' o 'parafraseig inadequat'). L'objectiu no és només evitar la detecció, sinó entendre, sintetitzar i presentar la informació amb la teva pròpia veu i anàlisi crítica. Aquesta pràctica soscava la integritat de la recerca." },
                { text: "Rebutjar la proposta, explicant que la revisió de literatura requereix una comprensió profunda i una síntesi original, no només una reformulació superficial. Suggerir utilitzar l'LLM per identificar articles rellevants o resumir-los inicialment (per a ús intern), però insistir que la redacció final sigui un producte del vostre propi treball intel·lectual.", type: "good", feedback: "<strong>Postura Ètica i Acadèmicament Sòlida:</strong> Defenses la integritat del procés de recerca i l'autoria intel·lectual. Proposes un ús legítim de l'LLM com a eina de suport, no com a substitut del treball analític i de síntesi." },
                { text: "Proposar utilitzar l'LLM per parafrasejar, però després revisar i editar manualment cada frase per 'fer-la vostra'.", type: "bad", feedback: "<strong>Pràctica Arriscada i Poc Ètica:</strong> Encara que hi hagi edició manual, l'origen de l'estructura i la seqüència d'idees prové de l'LLM parafrasejant altres autors. És difícil transformar realment aquest material en un treball original sense una comprensió i reescriptura molt profundes, i el risc de plagi no intencionat o de manca de profunditat analítica és alt." }
            ]
        }
    ];
    let currentEthicalDilemmaIdx = 0;

    function loadEthicalDilemma(index) {
        if (!ethicalDilemmaTextEl || !ethicalChoicesContainer || !ethicalFeedbackContainer || !ethicalDilemmas[index]) return;
        const dilemma = ethicalDilemmas[index];
        ethicalDilemmaTextEl.textContent = dilemma.scenario;
        ethicalChoicesContainer.innerHTML = ''; 
        dilemma.choices.forEach(choice => {
            const button = document.createElement('button');
            button.textContent = choice.text;
            button.classList.add('button', 'text-sm', 'mb-2', 'w-full', 'text-left', 'leading-tight'); 
            
            // Apply specific styles based on choice type
            if (choice.type === 'good') {
                button.style.backgroundColor = 'var(--secondary-color)';
                button.style.borderColor = 'var(--secondary-dark)';
            } else if (choice.type === 'bad') {
                button.style.backgroundColor = 'var(--warning-color)';
                button.style.borderColor = '#b45309'; // Darker shade of warning
            } else { // Neutral or other types
                 button.style.backgroundColor = 'var(--accent-purple)';
                 button.style.borderColor = '#7c3aed'; // Darker purple
            }
            
            button.onclick = () => {
                ethicalFeedbackContainer.innerHTML = choice.feedback; 
                ethicalFeedbackContainer.className = 'ethical-dilemma-feedback p-4 rounded-md shadow'; 
                ethicalFeedbackContainer.classList.add(choice.type === 'good' ? 'feedback-good' : 'feedback-bad');
                ethicalFeedbackContainer.style.display = 'block';
                requestAnimationFrame(() => { ethicalFeedbackContainer.style.opacity = '1'; });
            };
            ethicalChoicesContainer.appendChild(button);
        });
        ethicalFeedbackContainer.style.display = 'none';
        ethicalFeedbackContainer.style.opacity = '0';
    }
    
    if (nextEthicalDilemmaBtn) {
        nextEthicalDilemmaBtn.addEventListener('click', () => {
            currentEthicalDilemmaIdx = (currentEthicalDilemmaIdx + 1) % ethicalDilemmas.length;
            loadEthicalDilemma(currentEthicalDilemmaIdx);
        });
    }
    if (ethicalDilemmas.length > 0 && ethicalDilemmaTextEl) { 
        loadEthicalDilemma(currentEthicalDilemmaIdx);
    }

    // --- AI Literacy Skills Interactive Diagram (Enhanced) ---
    const skillsContainer = document.querySelector('.ai-literacy-skills-container');
    const skillsData = [ // Ensure this is defined
        { title: "Comprensió Conceptual dels LLM", description: "Entendre els principis bàsics de com funcionen els LLM (dades d'entrenament, arquitectures com Transformers, aprenentatge per predicció).", details: "Això no requereix ser un expert en IA, sinó tenir una comprensió funcional que permeti anticipar fortaleses i debilitats. Per exemple, saber que els LLM generen text basant-se en probabilitats ajuda a entendre per què poden 'al·lucinar'." },
        { title: "Enginyeria de Prompts Estratègica", description: "Habilitat per dissenyar prompts clars, contextualitzats i efectius per obtenir els resultats desitjats de l'LLM.", details: "Inclou tècniques com el prompting de cadena de pensament (CoT), zero-shot/few-shot, l'ús de persones, i el refinament iteratiu per a tasques acadèmiques complexes." },
        { title: "Avaluació Crítica dels Resultats", description: "Capacitat per analitzar críticament la informació generada per LLM, identificant biaixos, imprecisions, al·lucinacions i omissions.", details: "Implica la verificació de fets amb fonts fiables, l'anàlisi de la coherència lògica, i la consideració de perspectives alternatives no presents en el resultat de l'LLM." },
        { title: "Integració Ètica i Responsable", description: "Coneixement i aplicació de principis ètics en l'ús d'LLM, incloent integritat acadèmica, privadesa de dades, i reconeixement de l'autoria.", details: "Això significa entendre què constitueix plagi en el context de la IA, com protegir informació sensible, i com citar o reconèixer adequadament l'assistència de l'IA segons les normatives." },
        { title: "Col·laboració Humà-IA Efectiva", description: "Habilitat per treballar de manera sinèrgica amb eines d'IA, aprofitant les seves fortaleses per augmentar les capacitats humanes, no per reemplaçar-les.", details: "Implica saber quan i com utilitzar un LLM per a diferents etapes d'un projecte (p. ex., pluja d'idees vs. redacció final), i com integrar els seus resultats en un treball més ampli que reflecteixi el propi pensament i anàlisi." },
        { title: "Adaptabilitat i Aprenentatge Continu", description: "Disposició i capacitat per mantenir-se actualitzat sobre l'evolució ràpida de les tecnologies d'IA, les seves noves aplicacions i les millors pràctiques emergents.", details: "El camp dels LLM canvia mensualment. Els estudiants han de ser aprenents àgils, disposats a explorar noves eines i tècniques a mesura que sorgeixen, sempre amb una perspectiva crítica." }
    ];

    if (skillsContainer) {
        skillsData.forEach(skill => {
            const item = document.createElement('div');
            item.classList.add('ai-literacy-skill-item', 'animate-on-scroll');
            item.innerHTML = `<h5>${skill.title}</h5><p>${skill.description}</p><div class="skill-details"><p><strong>Aplicació i Reflexió (Postgrau):</strong> ${skill.details}</p></div>`;
            item.addEventListener('click', () => {
                const isActive = item.classList.contains('active');
                skillsContainer.querySelectorAll('.ai-literacy-skill-item.active').forEach(activeItem => {
                    if (activeItem !== item) {
                        activeItem.classList.remove('active');
                        const otherDetails = activeItem.querySelector('.skill-details');
                        if(otherDetails) { otherDetails.style.maxHeight = null; otherDetails.style.opacity = '0'; setTimeout(() => { if(!activeItem.classList.contains('active')) otherDetails.style.display = 'none'; }, 400); }
                    }
                });
                if(!isActive){
                    item.classList.add('active');
                    const details = item.querySelector('.skill-details');
                    if (details) { 
                        details.style.display = 'block'; 
                        setTimeout(() => { details.style.maxHeight = details.scrollHeight + "px"; details.style.opacity = '1'; }, 10);
                    }
                } else {
                    item.classList.remove('active');
                    const details = item.querySelector('.skill-details');
                    if(details) { details.style.maxHeight = null; details.style.opacity = '0'; setTimeout(() => { if(!item.classList.contains('active')) details.style.display = 'none'; }, 400); }
                }
            });
            skillsContainer.appendChild(item);
        });
        // Re-observe newly added animated elements for skills
        const newSkillElements = skillsContainer.querySelectorAll('.animate-on-scroll');
        newSkillElements.forEach(el => { observer.observe(el);});
    }

    // --- References Population & Linking ---
    const references = [ // Ensure this is defined
        { id: 1, text: "Jalil, S. et al. (2023). Opportunities and challenges of ChatGPT in higher education: A systematic literature review. *International Journal of Educational Technology in Higher Education*.", link: "https://doi.org/10.1186/s41239-023-00423-8" },
        { id: 2, text: "Mhlanga, D. (2023). The Value of ChatGPT in Higher Education: An Analysis of the Benefits and Potential. *Journal of Higher Education Policy and Leadership*.", link: "https://fkip.ummetro.ac.id/journal/index.php/JHOPL/article/view/1076" },
        { id: 3, text: "Chan, C.K.Y. & Hu, W. (2023). Students’ voices on generative AI: perceptions, benefits, and challenges in higher education. *International Journal of Educational Technology in Higher Education*.", link: "https://doi.org/10.1186/s41239-023-00411-y" },
        { id: 4, text: "Rudolph, J. et al. (2023). ChatGPT: Bullshit spewer or the end of traditional assessments in higher education? *Journal of Applied Learning & Teaching*.", link: "https://doi.org/10.37074/jalt.2023.6.1.9" },
        { id: 5, text: "Avram, M. (2024). *The Impact of AI on Higher Education*. Techstrong.ai.", link: "https://techstrong.ai/articles/the-impact-of-ai-on-higher-education/" },
        { id: 6, text: "EDUCAUSE. (2025). *EDUCAUSE QuickPoll Results: Student Use of Generative AI*. EDUCAUSE.", link: "https://www.educause.edu/research-and-publications/research/student-use-of-generative-ai" }, 
        { id: 7, text: "Trust, T. et al. (2024). ‘It’s a Tool and You Need to Learn How to Use It’: A Survey of College Student Use of Generative AI. *Journal of Research on Technology in Education*.", link: "https://doi.org/10.1080/15391523.2024.2305868" },
        { id: 8, text: "Kung, T.H. et al. (2023). Performance of ChatGPT on USMLE: Potential for AI-assisted medical education using large language models. *PLOS Digital Health*.", link: "https://doi.org/10.1371/journal.pdig.0000198" },
        { id: 9, text: "Elon University. (n.d.). *New Student Guide to Artificial Intelligence*. Elon University.", link: "https://www.elon.edu/u/ diga/ai-guide-for-students/" }, 
        { id: 10, text: "European Commission & OECD. (2024). *AILit Framework: Empowering Learners for the AI Era*. World Economic Forum.", link: "https://www.weforum.org/impact/ai-literacy-for-all/" }, 
        { id: 11, text: "Kasneci, E. et al. (2023). ChatGPT for good? On opportunities and challenges of large language models for education. *Learning and Individual Differences*.", link: "https://doi.org/10.1016/j.lindif.2023.102274" },
        { id: 12, text: "Cotton, D.R.E. et al. (2023). Chatting and cheating: Ensuring academic integrity in the era of ChatGPT. *Innovations in Education and Teaching International*.", link: "https://doi.org/10.1080/14703297.2023.2190148" },
        { id: 13, text: "Simplilearn. (2024). *Top 15 In-Demand Tech Skills for 2024*. Simplilearn.", link: "https://www.simplilearn.com/top-technology-trends-and-jobs-article" },
        { id: 14, text: "Bender, E.M. et al. (2021). On the Dangers of Stochastic Parrots: Can Language Models Be Too Big? *FAccT '21*.", link: "https://doi.org/10.1145/3442188.3445922" },
        { id: 15, text: "Mindzak, M. & Fidalgo, P. (2023). The Case Against AI in Education: A Discursive Review of the Negative Impacts of Artificial Intelligence on Education. *Academia Letters*.", link: "https://doi.org/10.20935/AL5953" }, 
        { id: 16, text: "Zhai, X. (2022). ChatGPT user experience: Implications for education. *SSRN*.", link: "https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4312418" },
        { id: 17, text: "Google for Education. (2024). *Gemini for Google Workspace for Education*. Google.", link: "https://edu.google.com/workspace-for-education/gemini/" },
        { id: 18, text: "Lo, C.K. (2023). What Is the Impact of ChatGPT on Education? A Rapid Review of the Literature. *Education Sciences*.", link: "https://doi.org/10.3390/educsci13080810" },
        { id: 19, text: "Google Cloud. (2024). *Gemini for Google Workspace for Education*. Google Cloud.", link: "https://cloud.google.com/blog/products/workspace/gemini-for-google-workspace-for-education" },
        { id: 20, text: "Google. (2024). *Gemini for Google Workspace for Education*. Google Blog.", link: "https://blog.google/education/gemini-google-workspace-education/" },
        { id: 21, text: "Google. (2024). *How Google Workspace protects your Gemini data*. Google Workspace Learning Center.", link: "https://support.google.com/a/answer/13578600?hl=en" },
        { id: 22, text: "Google. (2024). *Gemini for Education FAQs*. Google for Education.", link: "https://edu.google.com/workspace-for-education/gemini/faq/" },
        { id: 23, text: "OpenAI. (2024). *Introducing ChatGPT Edu*. OpenAI Blog.", link: "https://openai.com/blog/introducing-chatgpt-edu" },
        { id: 24, text: "Liu, Y. et al. (2023). Can LLM-Generated Reviews Replace Human Reviews? A Case Study on ChatGPT. *arXiv*.", link: "https://arxiv.org/abs/2305.08701" },
        { id: 25, text: "Nature. (2023). *How to use ChatGPT and other AI tools in your research*. Nature.", link: "https://www.nature.com/articles/d41586-023-03901-6" },
        { id: 26, text: "Das, S. et al. (2024). GoAI: The Graph of AI Ideas. *arXiv*.", link: "https://arxiv.org/abs/2401.01029" },
        { id: 27, text: "Wang, B. et al. (2023). ResearchAgent: An LLM-based Agent for Complex Experimental Design. *arXiv*.", link: "https://arxiv.org/abs/2310.09866" },
        { id: 28, text: "Das, S. et al. (2024). *GoAI: The Graph of AI Ideas*. goai.id.", link: "https://goai.id/" },
        { id: 29, text: "University of Oxford. (2024). *Using generative AI in your studies*. University of Oxford.", link: "https://www.ox.ac.uk/students/academic/guidance/ai" },
        { id: 30, text: "Research.com. (2024). *Best AI Tools for Students*. Research.com.", link: "https://research.com/education/best-ai-tools-for-students" },
        { id: 31, text: "Gu, R. et al. (2024). Qualitative data analysis with large language models: a practice-led tutorial. *PsyArXiv*.", link: "https://psyarxiv.com/k5w9v/" },
        { id: 32, text: "Xiao, Y. et al. (2024). Using ChatGPT for qualitative data analysis: A tutorial with practical steps and prompts for using grounded theory methodology. *JMIR Preprints*.", link: "https://preprints.jmir.org/preprint/57060" },
        { id: 33, text: "Liang, W. et al. (2023). Can Large Language Models Write SQL? A Case Study. *arXiv*.", link: "https://arxiv.org/abs/2305.04800" },
        { id: 34, text: "OpenAI. (2023). *GPT-4 Can Generate Code for Statistical Analyses*. OpenAI.", link: "https://openai.com/research/gpt-4" }, 
        { id: 35, text: "Surameery, N.M.S. & Shakor, M.Y. (2023). Use of ChatGPT to Solve Statistical Problems. *International Journal of Mathematics and Computer Science*.", link: "https://ijmcs.future-in-tech.net/18.1/Nawzad-Muhsin-Shakor.pdf" },
        { id: 36, text: "Baidoo-Anu, D. & Owusu Ansah, L. (2023). Education in the era of generative artificial intelligence (AI): Understanding the potential benefits of ChatGPT in promoting teaching and learning. *Journal of AI*.", link: "https://www.globalscientificjournal.com/researchpaper/Education_in_the_Era_of_Generative_Artificial_Intelligence_AI_Understanding_the_Potential_Benefits_of_ChatGPT_in_Promoting_Teaching_and_Learning.pdf" }, 
        { id: 37, text: "Marr, B. (2024). *The Top 10 AI And Technology Trends In 2024 Everyone Must Be Ready For*. Forbes.", link: "https://www.forbes.com/sites/bernardmarr/2023/10/02/the-top-10-ai-and-technology-trends-in-2024-everyone-must-be-ready-for/" },
        { id: 38, text: "UNESCO. (2023). *ChatGPT and Artificial Intelligence in higher education: Quick start guide*. UNESCO.", link: "https://unesdoc.unesco.org/ark:/48223/pf0000385146" },
        { id: 39, text: "Wei, J. et al. (2022). Chain-of-Thought Prompting Elicits Reasoning in Large Language Models. *arXiv*.", link: "https://arxiv.org/abs/2201.11903" },
        { id: 40, text: "Huang, J. & Chang, K.C.C. (2022). Towards Reasoning in Large Language Models: A Survey. *arXiv*.", link: "https://arxiv.org/abs/2212.10403" },
        { id: 41, text: "Study.com. (2023). *89% of students admit to using ChatGPT for homework*. Study.com.", link: "https://study.com/resources/chatgpt-student-survey" },
        { id: 42, text: "Zhao, W.X. et al. (2023). A Survey of Large Language Models. *arXiv*.", link: "https://arxiv.org/abs/2303.18223" },
        { id: 43, text: "OpenAI. (2023). *GPT-4*. OpenAI.", link: "https://openai.com/research/gpt-4" },
        { id: 44, text: "Google. (2023). *Gemini: Our largest and most capable AI model*. Google.", link: "https://blog.google/technology/ai/google-gemini-ai/" },
        { id: 45, text: "Zamfirescu-Pereira, J. et al. (2023). Why Johnny Can't Prompt: How Non-AI Experts Try (and Fail) to Engineer Good Prompts. *CHI '23*.", link: "https://doi.org/10.1145/3544548.3581388" },
        { id: 46, text: "White, J. et al. (2023). A Prompt Pattern Catalog to Enhance Prompt Engineering with ChatGPT. *arXiv*.", link: "https://arxiv.org/abs/2302.11382" },
        { id: 47, text: "OpenAI. (n.d.). *Prompt engineering*. OpenAI API Documentation.", link: "https://platform.openai.com/docs/guides/prompt-engineering" },
        { id: 48, text: "Microsoft. (n.d.). *Introduction to prompt engineering*. Microsoft Learn.", link: "https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/prompt-engineering" },
        { id: 49, text: "Brown, T.B. et al. (2020). Language Models are Few-Shot Learners. *arXiv*.", link: "https://arxiv.org/abs/2005.14165" },
        { id: 50, text: "Mollick, E. & Mollick, L. (2023). Using AI to Implement Effective Teaching Strategies in Classrooms: Five Strategies, Including Prompts. *SSRN*.", link: "https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4404885" },
        { id: 51, text: "Shen, Y. et al. (2023). Large Language Models Are Human-Level Prompt Engineers. *arXiv*.", link: "https://arxiv.org/abs/2211.01910" },
        { id: 52, text: "Kojima, T. et al. (2022). Large Language Models are Zero-Shot Reasoners. *arXiv*.", link: "https://arxiv.org/abs/2205.11916" },
        { id: 53, text: "University of Michigan Library. (n.d.). *Prompting Generative AI for Research*. University of Michigan Library.", link: "https://guides.lib.umich.edu/c.php?g=1304254&p=9602307" },
        { id: 54, text: "Vanderbilt University. (n.d.). *Prompting ChatGPT for Education*. Vanderbilt University.", link: "https://www.vanderbilt.edu/digitalfutures/prompting-chatgpt-for-education/" },
        { id: 55, text: "Montclair State University. (n.d.). *AI Tools in Teaching and Learning*. Montclair State University.", link: "https://www.montclair.edu/information-technology/ai-tools-in-teaching-and-learning/" },
        { id: 56, text: "DataCamp. (n.d.). *ChatGPT Cheat Sheet for Data Science*. DataCamp.", link: "https://www.datacamp.com/cheat-sheet/chatgpt-cheat-sheet-for-data-science" },
        { id: 57, text: "GeeksforGeeks. (n.d.). *ChatGPT Prompt Engineering for Data Science*. GeeksforGeeks.", link: "https://www.geeksforgeeks.org/chatgpt-prompt-engineering-for-data-science/" },
        { id: 58, text: "ATLAS.ti. (n.d.). *Using ChatGPT for Qualitative Data Analysis*. ATLAS.ti.", link: "https://atlas-ti.com/insights/using-chatgpt-for-qualitative-data-analysis" },
        { id: 59, text: "Scribbr. (n.d.). *How to Use ChatGPT for Research*. Scribbr.", link: "https://www.scribbr.com/ai-tools/chatgpt-for-research/" },
        { id: 60, text: "Coursera. (n.d.). *Prompt Engineering for ChatGPT*. Coursera.", link: "https://www.coursera.org/learn/prompt-engineering" },
        { id: 61, text: "edX. (n.d.). *Prompt Engineering and Advanced ChatGPT*. edX.", link: "https://www.edx.org/learn/prompt-engineering/ibm-prompt-engineering-and-advanced-chatgpt" },
        { id: 62, text: "PromptPerfect. (n.d.). *Prompt Engineering Guide*. PromptPerfect.", link: "https://promptperfect.xyz/prompt-engineering-guide" },
        { id: 63, text: "Medium. (n.d.). *ChatGPT Prompts for Data Analysis*. Medium.", link: "https://medium.com/@ferrario.curtis/chatgpt-prompts-for-data-analysis-611789646700" }, 
        { id: 64, text: "Semantic Scholar. (n.d.). *Semantic Scholar*. Semantic Scholar.", link: "https://www.semanticscholar.org/" },
        { id: 65, text: "Qualitative Data Analysis Services. (n.d.). *Using ChatGPT for Qualitative Data Analysis*. QDA Services.", link: "https://qdadataanalysis.com/using-chatgpt-for-qualitative-data-analysis/" },
        { id: 66, text: "Hamilton, M. et al. (2023). Prompt Engineering for Meaningful Qualitative Data Analysis with LLMs. *Medium*.", link: "https://medium.com/@marybec/prompt-engineering-for-meaningful-qualitative-data-analysis-with-llms-851e89b7219e" },
        { id: 67, text: "NVivo. (n.d.). *The Role of AI in Qualitative Data Analysis*. NVivo.", link: "https://www.qsrinternational.com/nvivo-qualitative-data-analysis-software/resources/blog/the-role-of-ai-in-qualitative-data-analysis" },
        { id: 68, text: "University of California, Berkeley. (n.d.). *Privacy Considerations for AI*. UC Berkeley Privacy Office.", link: "https://privacy.berkeley.edu/resources/ai" },
        { id: 69, text: "Google. (2024). *Gemini for Education*. Google for Education.", link: "https://edu.google.com/intl/en_us/products/gemini/" }, 
        { id: 70, text: "Statology. (n.d.). *Using ChatGPT for Statistics*. Statology.", link: "https://www.statology.org/chatgpt-for-statistics/" },
        { id: 71, text: "Chen, Z. et al. (2023). Text-to-SQL Empowered by Large Language Models: A Benchmark Evaluation. *arXiv*.", link: "https://arxiv.org/abs/2305.13128" },
        { id: 72, text: "Sobania, D. et al. (2023). An Analysis of the Automatic Generation of Programming Exercises by ChatGPT. *ITiCSE '23*.", link: "https://doi.org/10.1145/3587102.3588829" },
        { id: 73, text: "Yin, R.K. (2018). *Case Study Research and Applications: Design and Methods*. Sage Publications.", link: "https://us.sagepub.com/en-us/nam/case-study-research-and-applications/book250095" },
        { id: 74, text: "Creswell, J.W. & Creswell, J.D. (2018). *Research Design: Qualitative, Quantitative, and Mixed Methods Approaches*. Sage Publications.", link: "https://us.sagepub.com/en-us/nam/research-design/book246872" },
        { id: 75, text: "University of Southern California Libraries. (n.d.). *Research Guides: Organizing Your Social Sciences Research Paper*. USC Libraries.", link: "https://libguides.usc.edu/writingguide/researchpaper" },
        { id: 76, text: "QuestionPro. (n.d.). *Survey Design*. QuestionPro.", link: "https://www.questionpro.com/survey-design/" },
        { id: 77, text: "Experiment Design Assistant. (n.d.). *Experiment Design Assistant*. EDA.", link: "https://eda.nc3rs.org.uk/" },
        { id: 78, text: "GraphPad. (n.d.). *Designing Experiments*. GraphPad.", link: "https://www.graphpad.com/guides/prism/latest/user-guide/designing_experiments.htm" },
        { id: 79, text: "Stellenbosch University. (2023). *Guidelines for the Use of Artificial Intelligence (AI) Tools in Teaching, Learning and Assessment*. Stellenbosch University.", link: "https://www.sun.ac.za/english/learning-teaching/Documents/Generative_AI_Task_Team/SU%20Guidelines_Use%20of%20AI%20Tools_1%20Aug%202023.pdf" },
        { id: 80, text: "Birkbeck, University of London. (2024). *Guidance on the use of Generative AI in assessment*. Birkbeck, University of London.", link: "https://www.bbk.ac.uk/students/exams/assessment-guidance/generative-ai" },
        { id: 81, text: "University of Waterloo. (n.d.). *AI Guidelines for Students*. University of Waterloo.", link: "https://uwaterloo.ca/provost/guidelines-use-generative-artificial-intelligence/ai-guidelines-students" },
        { id: 82, text: "Lake Forest College. (n.d.). *Artificial Intelligence (AI) Policy*. Lake Forest College.", link: "https://www.lakeforest.edu/academics/artificial-intelligence-ai-policy" },
        { id: 83, text: "NIST. (2023). *AI Risk Management Framework*. National Institute of Standards and Technology.", link: "https://www.nist.gov/itl/ai-risk-management-framework" },
        { id: 84, text: "American Military University. (n.d.). *Acceptable Use of AI Policy*. AMU.", link: "https://www.amu.apus.edu/academic-integrity/ai-policy.html" }, 
        { id: 85, text: "Inside Higher Ed. (2023). *AI and Academic Integrity*. Inside Higher Ed.", link: "https://www.insidehighered.com/news/tech-innovation/artificial-intelligence/2023/01/12/ai-and-academic-integrity-battle-begins" },
        { id: 86, text: "Dwivedi, Y.K. et al. (2023). “So what if ChatGPT wrote it?” Multidisciplinary perspectives on opportunities, challenges and implications of generative conversational AI for research, practice and policy. *International Journal of Information Management*.", link: "https://doi.org/10.1016/j.ijinfomgt.2023.102642" },
        { id: 87, text: "Floridi, L. (2023). AI as Agency: A Philosophical Perspective. *Philosophy & Technology*.", link: "https://doi.org/10.1007/s13347-023-00625-5" },
        { id: 88, text: "Eightfold AI. (n.d.). *Steve - Your AI Career Coach*. Eightfold AI.", link: "https://eightfold.ai/steve/" },
        { id: 89, text: "Forbes. (2023). *AI-Powered Career Coaching*. Forbes.", link: "https://www.forbes.com/advisor/education/career-development/ai-career-coach/" },
        { id: 90, text: "University of Technology Sydney. (n.d.). *Using AI tools for career development*. UTS Careers.", link: "https://careerhub.uts.edu.au/s/article/ai-tools-for-career-development" },
        { id: 91, text: "Coursera Blog. (2023). *How to Use ChatGPT for Your Career*. Coursera.", link: "https://www.coursera.org/articles/chatgpt-for-career" },
        { id: 92, text: "Kickresume. (n.d.). *AI Resume Writer*. Kickresume.", link: "https://www.kickresume.com/en/ai-resume-writer" },
        { id: 93, text: "Teal HQ. (n.d.). *AI Resume Builder*. Teal HQ.", link: "https://www.tealhq.com/ai-resume-builder" },
        { id: 94, text: "LinkedIn. (2024). *New AI-powered features to help you find your next opportunity and grow your career*. LinkedIn Official Blog.", link: "https://www.linkedin.com/pulse/new-ai-powered-features-help-you-find-your-next-opportunity/" },
        { id: 95, text: "Big Interview. (n.d.). *AI Interview Coach*. Big Interview.", link: "https://biginterview.com/ai-interview-coach/" },
        { id: 96, text: "Poised. (n.d.). *AI Communication Coach*. Poised.", link: "https://www.poised.com/" },
        { id: 97, text: "World Economic Forum. (2023). *Future of Jobs Report 2023*. WEF.", link: "https://www.weforum.org/reports/future-of-jobs-report-2023/" },
        { id: 98, text: "McKinsey & Company. (2023). *Generative AI and the future of work in America*. McKinsey Global Institute.", link: "https://www.mckinsey.com/mgi/our-research/generative-ai-and-the-future-of-work-in-america" },
        { id: 99, text: "Harvard Business Review. (2023). *How Generative AI Is Changing Creative Work*. HBR.", link: "https://hbr.org/2023/04/how-generative-ai-is-changing-creative-work" },
        { id: 100, text: "OpenAI. (2024). *GPT-4o*. OpenAI.", link: "https://openai.com/index/hello-gpt-4o/" },
        { id: 101, text: "Microsoft. (2024). *Copilot for Microsoft 365*. Microsoft.", link: "https://www.microsoft.com/en-us/microsoft-copilot/microsoft-copilot-for-microsoft-365" }
    ];

    const referencesListEl = getEl('references-list');
    if (referencesListEl && references) { 
        references.forEach(ref => {
            const refItem = document.createElement('div');
            refItem.classList.add('reference-item', 'animate-on-scroll');
            refItem.setAttribute('data-ref-id', `[${ref.id}]`);
            
            let textContent = `${ref.text}`;
            if (ref.link) {
                textContent += ` <a href="${ref.link}" target="_blank" rel="noopener noreferrer">[Link]</a>`;
            }
            refItem.innerHTML = textContent;
            referencesListEl.appendChild(refItem);
        });
        // Re-observe newly added animated elements for references
        const newAnimatedElementsInRefs = referencesListEl.querySelectorAll('.animate-on-scroll');
        newAnimatedElementsInRefs.forEach(el => { observer.observe(el); });
    }

    // Final check for MathJax rendering if content was added dynamically
    if (typeof MathJax !== "undefined" && MathJax.typesetPromise) {
        // Timeout to ensure DOM is fully updated
        setTimeout(() => {
            MathJax.typesetPromise();
        }, 500);
    }

}); // End of DOMContentLoaded
</script>
